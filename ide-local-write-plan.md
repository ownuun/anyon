# IDE-스타일 로컬 쓰기 플랜

- 목표: 백엔드가 IDE처럼 모든 프로젝트의 실제 리포 경로에 바로 쓰고, 워크트리 기능을 유지하면서 문서 저장 500을 없앤다.
- 전제: 각 프로젝트의 `git_repo_path`가 실제 Git 리포 위치를 가리키고, 해당 경로에 쓰기 권한을 확보한다.

## 1) 프로젝트 경로 정리
- 각 프로젝트마다 DB에 저장된 `git_repo_path`를 확인한다.
- 선택지:
  - a) 현 경로 유지: 기존 `git_repo_path` 그대로 쓰고 권한만 연다.
  - b) 작업 중인 워크스페이스로 변경: `git_repo_path`를 현재 작업 디렉토리로 업데이트(또는 새 프로젝트 생성). 이 경우 문서/워크트리가 현재 워크스페이스 안에서 동작해 샌드박스 제약이 줄어든다.

## 2) macOS 권한/퍼미션 확보
- 시스템 설정 → 개인정보 보호 및 보안 → 전체 디스크 접근 또는 파일/폴더 접근에서 사용 중인 터미널/IDE에 대상 경로 접근을 허용.
- 필요 시 `chmod u+w <경로>`로 사용자 쓰기 권한 추가(예: `<git_repo_path>/anyon-docs` 혹은 변경한 리포 경로).
- 샌드박스 환경이면 백엔드를 샌드박스 밖에서 실행하거나, 해당 경로 쓰기를 허용하도록 설정.

## 3) 백엔드/프론트 실행
- 백엔드: `BACKEND_PORT=3001 RUST_LOG=debug cargo run -p server --bin server`
- 프론트: `pnpm run frontend:dev` (또는 `pnpm run dev` 사용 시 자동 포트 설정)

## 4) 워크트리/리포 정상 여부 확인
- 선택한 `git_repo_path`에 실제 Git 리포가 존재하는지 확인(`git status`).
- 워크트리 생성/삭제는 동일 경로 권한만 있으면 기존 로직 그대로 동작.

## 5) 문서/저장 동작 검증
- 수동 API: 프로젝트별 ID와 문서 ID를 넣어 PUT 요청을 수행해 실제 파일이 갱신되는지 확인한다. 기대: 200 OK, 대상 경로의 문서 내용 변경.
- 프론트 플로우: 기획 탭 → 대화 탭 → PRD 열기 → 수정 → Save → 500 없이 “Saved” 토스트, 디스크 내용 반영.

## 6) UX/에러 핸들링 개선(선택)
- 문서 업데이트 시 대상 경로 쓰기 가능 여부를 사전 체크해, 권한 부족이면 500 대신 명확한 에러 메시지 반환.
- UI에 “저장 위치 권한 없음” 배너/토스트를 추가해 사용자 혼선을 줄이기.

## 예시 (참고)
- 프로젝트 A: `git_repo_path=/Users/cosmos/Documents/dev/test`  
  - 권한: macOS 전체 디스크 접근에서 터미널/IDE에 해당 경로 허용, 필요 시 `chmod u+w /Users/cosmos/Documents/dev/test/anyon-docs`.
  - 검증: `curl -X PUT http://localhost:3001/api/projects/<projA_id>/documents/<doc_id> ...` → 파일 `/Users/cosmos/Documents/dev/test/anyon-docs/<카테고리>/<파일>.md` 내용 변경 확인.
- 프로젝트 B: `git_repo_path=/Users/cosmos/Documents/anyon-mvp`  
  - 워크스페이스 안에서 동작하므로 샌드박스 제약이 적음. 동일하게 권한/검증 절차 반복.

## IDE처럼 더 매끄럽게 만들기 위한 추가 작업
- 사전 점검(자동): 앱 시작이나 저장 전에 문서를 쓸 폴더가 존재/쓰기 가능한지 자동 검사하고, 문제면 바로 알려줌.
- 명확한 오류 메시지: 권한 없음, 폴더 없음, 샌드박스 차단 등 상황별로 구체적 안내(500 대신 이유를 표시).
- 경로 관리: 각 프로젝트의 `git_repo_path`가 실제 폴더인지 확인하고, 문서 폴더(`anyon-docs/...`)를 자동 생성/정렬. 어긋나면 안내하거나 자동 수정.
- 자동 테스트: 정상/권한 없음/폴더 없음 같은 시나리오를 자동으로 돌려서 문제를 미리 잡기.
- 환경별 안내: 맥/샌드박스/도커 등 실행 환경마다 필요한 권한 설정(전체 디스크 접근, 폴더 권한 부여 등)을 가이드로 제공.
